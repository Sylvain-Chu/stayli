{{> header activeNav="bookings" }}
{{> sidebar activeNav="bookings" }}
<link rel="stylesheet" href="/css/pages/booking-show-modern.css">

<div class="booking-header-bar">
  <div class="booking-breadcrumbs">
    <a href="/bookings">{{t "bookings.title"}}</a> /
    <span>#BK-{{booking.id}}</span>
  </div>
  <div class="booking-header-main">
    <div>
      <h1 class="booking-title">{{t "bookings.showTitle"}}</h1>
    </div>
    <div class="booking-header-actions">
  <a class="booking-action-btn" href="/bookings/{{booking.id}}/edit"><i data-feather="edit-2"></i> {{t "bookings.edit"}}</a>
      <button class="booking-action-btn secondary"><i data-feather="send"></i> {{t "bookings.sendConfirmation"}}</button>
      <button class="booking-action-btn danger"><i data-feather="x-circle"></i> {{t "bookings.cancel"}}</button>
    </div>
  </div>
</div>

<div class="booking-main-grid">
  <div class="booking-main-left">
    <!-- Reservation Summary Card (modern) -->
    <div class="booking-card summary-card">
      <div class="booking-card-header">{{t "bookings.reservationSummary"}}</div>
      <div class="booking-card-content">
        <div class="booking-summary-row">
          <img class="booking-summary-img" src="{{booking.property.imageUrl}}" alt="{{booking.property.name}}" onerror="this.style.display='none'">
          <div>
            <a class="booking-summary-title" href="/properties/{{booking.property.id}}">{{booking.property.name}}</a>
            <div class="booking-summary-address">{{booking.property.address}}</div>
            <button class="booking-summary-btn" onclick="window.location='/properties/{{booking.property.id}}'">{{t "properties.viewProperty"}}</button>
          </div>
        </div>
        <div class="booking-summary-details">
          <div>
            <span class="booking-summary-label">{{t "bookings.checkIn"}}</span><br>
            <span class="booking-summary-value">{{formatDateShort booking.startDate}}</span>
          </div>
          <div>
            <span class="booking-summary-label">{{t "bookings.checkOut"}}</span><br>
            <span class="booking-summary-value">{{formatDateShort booking.endDate}}</span>
          </div>
          <div>
            <span class="booking-summary-label">{{t "bookings.duration"}}</span><br>
            <span class="booking-summary-value">{{durationNights}} {{t "bookings.nights"}}</span>
          </div>
          <div>
            <span class="booking-summary-label">{{t "bookings.guests"}}</span><br>
            <span class="booking-summary-value">
              {{#if booking.children}}
                {{booking.adults}} {{t "bookings.adult"}}{{#if (gt booking.adults 1)}}s{{/if}}, {{booking.children}} {{t "bookings.child"}}{{#if (gt booking.children 1)}}ren{{/if}}
              {{else}}
                {{booking.adults}} {{t "bookings.adult"}}{{#if (gt booking.adults 1)}}s{{/if}}
              {{/if}}
            </span>
          </div>
        </div>
      </div>
    </div>
    <!-- Financials Card (modern) -->
    <div class="booking-card financials-card">
      <div class="booking-card-header">{{t "bookings.financials"}}</div>
      <div class="booking-card-content">
        <div class="booking-financials-grid">
          <div>
            <div class="booking-section-title">{{t "bookings.priceBreakdown"}}</div>
            <div class="booking-financials-breakdown">
              <div class="flex justify-between">
                <span class="booking-summary-label">{{t "bookings.basePrice"}} ({{durationNights}} {{t "bookings.nights"}} â€” {{t booking.seasonLabel}})</span>
                <span class="booking-summary-value">{{currency booking.basePrice}}</span>
              </div>
              
              {{#if booking.discountAmount}}
              <div class="flex justify-between" style="color:#059669;">
                <span class="booking-summary-label">{{t "bookings.discount"}}{{#if (eq booking.discountType 'percent')}} ({{booking.discount}}%){{/if}}</span>
                <span class="booking-summary-value">-{{currency booking.discountAmount}}</span>
              </div>
              {{/if}}
              
              {{#if booking.hasLinens}}
              <div class="flex justify-between"><span class="booking-summary-label">{{t "bookings.linens"}}</span><span class="booking-summary-value">{{currency booking.linensPrice}}</span></div>
              {{/if}}
              
              {{#if booking.hasCleaning}}
              <div class="flex justify-between"><span class="booking-summary-label">{{t "bookings.cleaning"}}</span><span class="booking-summary-value">{{currency booking.cleaningPrice}}</span></div>
              {{/if}}
              
              {{#if booking.hasCancellationInsurance}}
              <div class="flex justify-between"><span class="booking-summary-label">{{t "bookings.insurance"}}</span><span class="booking-summary-value">{{currency booking.insuranceFee}}</span></div>
              {{/if}}
              
              {{#if booking.taxes}}
              <div class="flex justify-between"><span class="booking-summary-label">{{t "bookings.touristTax"}} ({{booking.adults}}{{#if booking.children}} + {{booking.children}}{{/if}} {{t "bookings.guests"}})</span><span class="booking-summary-value">{{currency booking.taxes}}</span></div>
              {{/if}}
              
              <div class="flex justify-between" style="border-top:1px solid #e5e7eb;margin-top:0.7rem;padding-top:0.7rem;"><span class="booking-summary-label" style="font-weight:700;color:#222;font-size:1.1rem;">{{t "bookings.totalPrice"}}</span><span class="booking-summary-value" style="font-weight:700;color:#222;font-size:1.1rem;">{{currency booking.totalPrice}}</span></div>
            </div>
            
            {{#if booking.specialRequests}}
            <div style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid #e5e7eb;">
              <div class="booking-section-title">{{t "bookings.specialRequests"}}</div>
              <p style="color:#6b7280;font-size:0.95rem;line-height:1.6;margin-top:0.5rem;">{{booking.specialRequests}}</p>
            </div>
            {{/if}}
          </div>
          <div>
            <div class="booking-section-title">{{t "bookings.relatedInvoices"}}</div>
            <div class="overflow-x-auto">
              <table class="booking-card-table">
                <thead><tr><th>{{t "invoices.invoiceNumber"}}</th><th>{{t "invoices.amount"}}</th><th>{{t "invoices.status"}}</th></tr></thead>
                <tbody>
                  {{#if booking.invoice}}
                  <tr>
                    <td><a href="/invoices/{{booking.invoice.id}}">{{booking.invoice.id}}</a></td>
                    <td>{{currency booking.invoice.amount}}</td>
                    <td><span class="booking-badge {{booking.invoice.status}}">{{capitalize booking.invoice.status}}</span></td>
                  </tr>
                  {{else}}
                  <tr><td colspan="3" style="text-align:center;color:#888;">{{t "bookings.noInvoice"}}</td></tr>
                  {{/if}}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="booking-main-right">
    <!-- Client Information Card -->
    <div class="booking-card">
      <div class="booking-card-header">{{t "bookings.clientInformation"}}</div>
      <div class="booking-card-content">
        <div class="booking-client-info">
          <img class="booking-client-avatar" src="{{booking.client.avatarUrl}}" alt="{{booking.client.firstName}} {{booking.client.lastName}}" onerror="this.style.display='none'">
          <div class="booking-client-details">
            <a class="booking-client-name" href="/clients/{{booking.client.id}}">{{booking.client.firstName}} {{booking.client.lastName}}</a>
            <div class="booking-client-email">{{booking.client.email}}</div>
            <div class="booking-client-phone">{{booking.client.phone}}</div>
          </div>
        </div>
        {{!-- <div class="booking-client-special" style="margin-top:1.2rem;">
          <span style="color:#617c89;font-weight:500;font-size:0.97rem;">Special Requests</span><br>
          <span class="booking-client-special-text">{{booking.client.specialRequests}}</span>
        </div> --}}
      </div>
    </div>
    <!-- Status Card (modern) -->
    <div class="booking-card status-card">
      <div class="booking-card-header">{{t "bookings.status"}}</div>
      <div class="booking-card-content">
        <div class="booking-status-block">
          <div class="booking-status-label">{{t "bookings.bookingStatus"}}</div>
          <div class="booking-badge {{booking.status}}"><i data-feather="check-circle" style="font-size:1em;"></i> {{capitalize booking.status}}</div>
        </div>
        <div class="booking-status-block">
          <div class="booking-status-label">{{t "bookings.paymentStatus"}}</div>
          {{#if booking.invoice}}
            <div class="booking-badge {{booking.invoice.status}}"><i data-feather="credit-card" style="font-size:1em;"></i> {{capitalize booking.invoice.status}}</div>
          {{else}}
            <div class="booking-badge">{{t "bookings.noInvoice"}}</div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</div>
{{> footer}}