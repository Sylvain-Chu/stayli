{{> header }}
{{> sidebar }}


<div class="page-header-modern">
  <div class="page-header-titles">
    <h1>{{t 'bookings.title'}}</h1>
    <p class="page-subtitle">{{t 'bookings.subtitle'}}</p>
  </div>
  <div class="page-header-actions">
    <a href="/bookings/create" class="btn btn-primary">
      <i data-feather="plus"></i>
      {{t 'bookings.addNew'}}
    </a>
  </div>
</div>


<div class="filters-section table-filters-modern">
  <form method="GET" action="/bookings" class="filters-form-table-modern">
    <div class="filter-group">
      <label for="search-input" class="filter-label">{{t 'bookings.filterSearchLabel' 'Search'}}</label>
      <input 
        type="search" 
        id="search-input"
        name="q" 
        placeholder="{{t 'bookings.searchPlaceholder'}}" 
        value="{{q}}"
        class="search-input-modern"
        autocomplete="off"
      />
    </div>
    <div class="filter-group">
      <label for="date-from" class="filter-label">{{t 'bookings.filterDateLabel' 'Date Range'}}</label>
      <div class="filter-date-range">
        <input type="date" id="date-from" name="from" value="{{from}}" class="date-input-modern" />
        <span class="date-range-sep">-</span>
        <input type="date" id="date-to" name="to" value="{{to}}" class="date-input-modern" />
      </div>
    </div>
    <div class="filter-group">
      <label for="status-filter" class="filter-label">{{t 'bookings.filterStatusLabel' 'Status'}}</label>
      <select id="status-filter" name="status" class="filter-select-modern">
        <option value=''>{{t 'common.all'}}</option>
        <option value='pending' {{#if (eq status 'pending')}}selected{{/if}}>{{t 'common.statuses.pending'}}</option>
        <option value='confirmed' {{#if (eq status 'confirmed')}}selected{{/if}}>{{t 'common.statuses.confirmed'}}</option>
        <option value='completed' {{#if (eq status 'completed')}}selected{{/if}}>{{t 'common.statuses.completed'}}</option>
        <option value='cancelled' {{#if (eq status 'cancelled')}}selected{{/if}}>{{t 'common.statuses.cancelled'}}</option>
        <option value='blocked' {{#if (eq status 'blocked')}}selected{{/if}}>{{t 'common.statuses.blocked'}}</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="sort-filter" class="filter-label">{{t 'bookings.sortBy'}}</label>
      <select id="sort-filter" name="sort" class="filter-select-modern">
        <option value='newest' {{#if (eq sort 'newest')}}selected{{/if}}>{{t 'bookings.sortNewest'}}</option>
        <option value='oldest' {{#if (eq sort 'oldest')}}selected{{/if}}>{{t 'bookings.sortOldest'}}</option>
        <option value='price-high' {{#if (eq sort 'price-high')}}selected{{/if}}>{{t 'bookings.sortPriceHigh'}}</option>
        <option value='price-low' {{#if (eq sort 'price-low')}}selected{{/if}}>{{t 'bookings.sortPriceLow'}}</option>
        <option value='name' {{#if (eq sort 'name')}}selected{{/if}}>{{t 'bookings.sortName'}}</option>
      </select>
    </div>
    <div class="filter-group filter-group-btn">
      <label class="filter-label">&nbsp;</label>
      <button type="submit" class="btn btn-modern-filter" title="{{t 'common.filter'}}">
        <i data-feather="search"></i>
      </button>
    </div>
  </form>
</div>

<table class="bookings-table">
  <thead>
    <tr>
      <th>{{t 'bookings.guest'}}</th>
      <th>{{t 'bookings.property'}}</th>
      <th>{{t 'bookings.dates'}}</th>
      <th>{{t 'bookings.status'}}</th>
      <th>{{t 'bookings.totalPrice'}}</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {{#each bookings}}
      <tr>
        <td class="guest-cell">
          <div class="guest-avatar">
            <img src="https://api.dicebear.com/7.x/initials/svg?seed={{this.client.firstName}}%20{{this.client.lastName}}" alt="{{this.client.firstName}} {{this.client.lastName}}" />
          </div>
          <div class="guest-name">{{this.client.firstName}} {{this.client.lastName}}</div>
        </td>
        <td>{{this.property.name}}</td>
        <td>{{formatDate this.startDate}} &rarr; {{formatDate this.endDate}}</td>
        <td>
          <span class="status-badge status-{{this.status}}">
            {{#if (eq this.status 'confirmed')}}{{t 'common.statuses.confirmed'}}{{/if}}
            {{#if (eq this.status 'pending')}}{{t 'common.statuses.pending'}}{{/if}}
            {{#if (eq this.status 'cancelled')}}{{t 'common.statuses.cancelled'}}{{/if}}
            {{#if (eq this.status 'completed')}}{{t 'common.statuses.completed'}}{{/if}}
            {{#if (eq this.status 'blocked')}}{{t 'common.statuses.blocked'}}{{/if}}
          </span>
        </td>
        <td>{{currency this.totalPrice}}</td>
        <td>
          <a href='/bookings/{{this.id}}' class="table-action"><i data-feather="eye"></i></a>
        </td>
      </tr>
    {{else}}
      <tr><td colspan="6" class="empty-table">{{t 'bookings.noBookings'}}</td></tr>
    {{/each}}
  </tbody>
</table>


<div class="table-pagination">
  <div class="pagination-info-row">
    <span>
      {{t 'common.showing'}}
      {{#if totalCount}}
        {{math (math (math page 1 '-') perPage '*') 1 '+'}}-{{math (math (math page perPage '*') totalCount 'min') 0 'max'}}
      {{else}}
        0
      {{/if}}
      {{t 'common.of'}} {{totalCount}}
    </span>
    <form method="GET" action="/bookings" class="pagination-perpage-form">
      {{!-- Conserve tous les filtres courants en hidden --}}
      <input type="hidden" name="q" value="{{q}}" />
      <input type="hidden" name="from" value="{{from}}" />
      <input type="hidden" name="to" value="{{to}}" />
      <input type="hidden" name="status" value="{{status}}" />
      <input type="hidden" name="sort" value="{{sort}}" />
      <input type="hidden" name="page" value="{{page}}" />
      <select id="perPage-select" name="perPage" class="filter-select-modern" title="{{t 'bookings.perPage'}}" onchange="this.form.submit()">
        <option value="5" {{#if (eq perPage 5)}}selected{{/if}}>5 / page</option>
        <option value="10" {{#if (eq perPage 10)}}selected{{/if}}>10 / page</option>
        <option value="20" {{#if (eq perPage 20)}}selected{{/if}}>20 / page</option>
        <option value="50" {{#if (eq perPage 50)}}selected{{/if}}>50 / page</option>
      </select>
    </form>
  </div>
  <div class="pagination-controls">
    {{!-- Previous button --}}
    {{#if (gt page 1)}}
      <a href="?{{queryString q=q from=from to=to status=status sort=sort page=(math page 1 '-') perPage=perPage}}" class="pagination-btn">Previous</a>
    {{else}}
      <span class="pagination-btn disabled">Previous</span>
    {{/if}}

    {{!-- Page numbers (show up to 5 pages around current) --}}
    {{#each (paginationPages page totalPages)}}
      {{#if (eq this ../page)}}
        <span class="pagination-btn active">{{this}}</span>
      {{else}}
        <a href="?{{queryString q=../q from=../from to=../to status=../status sort=../sort page=this perPage=../perPage}}" class="pagination-btn">{{this}}</a>
      {{/if}}
    {{/each}}

    {{!-- Next button --}}
    {{#if (lt page totalPages)}}
      <a href="?{{queryString q=q from=from to=to status=status sort=sort page=(math page 1 '+') perPage=perPage}}" class="pagination-btn">Next</a>
    {{else}}
      <span class="pagination-btn disabled">Next</span>
    {{/if}}
  </div>
</div>

{{> footer }}