{{> header }}
{{> sidebar }}
<h1>Dashboard</h1>

<div class="tabs">
  <a class="tab {{#if (eq scope 'week')}}active{{/if}}" href="/dashboard?scope=week">Cette semaine</a>
  <a class="tab {{#if (eq scope 'month')}}active{{/if}}" href="/dashboard?scope=month">Ce mois</a>
  <span class="muted" style="margin-left:8px; font-size:12px;">Filtre l’étendue des arrivées et départs</span>
</div>

<section class="cards">
  <div class="card">
    <div class="card-title"><i data-feather="home"></i> Total Properties</div>
    <div class="card-value countup" data-count="{{stats.propertiesCount}}">0</div>
    <div class="muted" style="margin-top:6px; font-size:12px;">Currently occupied: {{stats.currentlyOccupiedProperties}} ({{stats.occupancyPercent}}%)</div>
  </div>
  <div class="card">
    <div class="card-title"><i data-feather="users"></i> Total Clients</div>
    <div class="card-value countup" data-count="{{stats.clientsCount}}">0</div>
  </div>
  <div class="card">
    <div class="card-title"><i data-feather="trending-up"></i> Revenu du mois</div>
    <div class="card-value countup" data-count="{{stats.revenueThisMonth}}">{{currency 0}}</div>
    <div class="muted" style="margin-top:4px; font-size:12px;">Objectif: {{currency stats.revenueGoal}} — {{stats.revenueProgressPercent}}%</div>
    <div class="progress" aria-label="Revenue goal progress">
      <div class="bar" style="width: {{stats.revenueProgressPercent}}%"></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title"><i data-feather="clock"></i> Factures en attente</div>
    <div class="card-value countup" data-count="{{stats.pendingInvoices}}">0</div>
  </div>

  <div class="card full">
      <div class="mini-cal-header">{{calendar.monthLabel}}</div>
      <div class="mini-cal-grid">
        {{#each calendar.days}}
          {{#if this.isBlank}}
            <div class="mini-cal-cell blank"></div>
          {{else}}
            <div class="mini-cal-cell {{#if this.occupied}}occ{{/if}} {{#if this.isToday}}today{{/if}}" data-info="{{this.info}}" title="{{this.info}}">
              {{this.day}}
            </div>
          {{/if}}
        {{/each}}
      </div>
    </div>
  </div>
</section>

<section class="dashboard-grid">
  <div class="column">
    <h2>Occupations en cours</h2>
    {{#if currentStays.length}}
      <ul class="list">
        {{#each currentStays}}
          <li class="list-item {{#if this.isToday}}today-event{{/if}}">
            <div class="item-title">
              <span class="badge" title="Séjour"><i data-feather="moon"></i></span>
              <a href="/clients/{{this.client.id}}">{{this.client.firstName}} {{this.client.lastName}}</a>
              <span class="chip {{this.clientStatus}}">{{this.clientStatus}}</span>
            </div>
            <div class="item-sub"><a href="/properties/{{this.property.id}}">{{this.property.name}}</a></div>
            <div class="item-meta">Départ: ({{fromNow this.endDate}})</div>
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p class="muted">Aucun logement n'est actuellement occupé.</p>
    {{/if}}
  </div>

  <div class="column">
    <h2>Prochaines Arrivées</h2>
    {{#if arrivals.length}}
      <ul class="list">
        {{#each arrivals}}
          <li class="list-item {{#if this.isToday}}today-event{{/if}}">
            <div class="item-title">
              <span class="badge arrival" title="Arrivée"><i data-feather="corner-down-right"></i></span>
              <a href="/clients/{{this.client.id}}">{{this.client.firstName}} {{this.client.lastName}}</a>
              <span class="chip {{this.clientStatus}}">{{this.clientStatus}}</span>
            </div>
            <div class="item-sub"><a href="/properties/{{this.property.id}}">{{this.property.name}}</a></div>
            <div class="item-meta">Arrivée: ({{fromNow this.startDate}})</div>
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p class="muted">Aucune arrivée prévue pour la période sélectionnée.</p>
    {{/if}}
  </div>

  <div class="column">
    <h2>Départs Récents</h2>
    {{#if departures.length}}
      <ul class="list">
        {{#each departures}}
          <li class="list-item {{#if this.isToday}}today-event{{/if}}">
            <div class="item-title">
              <span class="badge departure" title="Départ"><i data-feather="corner-up-left"></i></span>
              <a href="/clients/{{this.client.id}}">{{this.client.firstName}} {{this.client.lastName}}</a>
              <span class="chip {{this.clientStatus}}">{{this.clientStatus}}</span>
            </div>
            <div class="item-sub"><a href="/properties/{{this.property.id}}">{{this.property.name}}</a></div>
            <div class="item-meta">Départ: ({{fromNow this.endDate}})</div>
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p class="muted">Aucun départ enregistré pour la période sélectionnée.</p>
    {{/if}}
  </div>
</section>
{{> footer }}